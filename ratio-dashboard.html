<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ì™€ ë¹„ìœ¨ í•™ìŠµ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .metric-change {
            font-size: 0.85em;
            padding: 4px 8px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .metric-change.positive {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .metric-change.negative {
            background: #ffebee;
            color: #c62828;
        }
        
        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .chart-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .student-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .table-header {
            background: #667eea;
            color: white;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        tr:hover {
            background: #fafafa;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }
        
        .concept-badge {
            display: inline-block;
            padding: 4px 10px;
            margin: 2px;
            border-radius: 20px;
            font-size: 0.85em;
            background: #f0f0f0;
        }
        
        .concept-badge.mastered {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .concept-badge.learning {
            background: #fff3cd;
            color: #856404;
        }
        
        .concept-badge.struggling {
            background: #ffebee;
            color: #c62828;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .realtime-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .filter-controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-label {
            font-size: 0.85em;
            color: #666;
            font-weight: 600;
        }
        
        select, input[type="date"] {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95em;
        }
        
        select:focus, input[type="date"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“Š ë¹„ì™€ ë¹„ìœ¨ í•™ìŠµ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
            <p class="subtitle">ì‹¤ì‹œê°„ í•™ìŠµ ë°ì´í„° ë¶„ì„ ë° ê°œì¸í™” ì¶”ì²œ ì‹œìŠ¤í…œ</p>
        </div>
        
        <!-- Filter Controls -->
        <div class="filter-controls">
            <div class="filter-group">
                <label class="filter-label">ê¸°ê°„</label>
                <select id="periodFilter">
                    <option value="today">ì˜¤ëŠ˜</option>
                    <option value="week" selected>ì´ë²ˆ ì£¼</option>
                    <option value="month">ì´ë²ˆ ë‹¬</option>
                    <option value="custom">ì§ì ‘ ì„ íƒ</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">í•™ê¸‰</label>
                <select id="classFilter">
                    <option value="all">ì „ì²´</option>
                    <option value="6-1">6í•™ë…„ 1ë°˜</option>
                    <option value="6-2">6í•™ë…„ 2ë°˜</option>
                    <option value="7-1">7í•™ë…„ 1ë°˜</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">ë¬¸ì œ ìœ í˜•</label>
                <select id="typeFilter">
                    <option value="all">ì „ì²´</option>
                    <option value="visual">ì‹œê°ì  ë¹„</option>
                    <option value="numerical">ìˆ˜ì¹˜ì  ë¹„</option>
                    <option value="application">ì‹¤ìƒí™œ ì‘ìš©</option>
                </select>
            </div>
            
            <button class="btn btn-primary" onclick="refreshDashboard()">
                ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
        
        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">í™œì„± í•™ìƒ ìˆ˜</div>
                <div class="metric-value" id="activeStudents">0</div>
                <span class="metric-change positive">â–² 12% ì¦ê°€</span>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">í‰ê·  ì •ë‹µë¥ </div>
                <div class="metric-value" id="avgAccuracy">0%</div>
                <span class="metric-change positive">â–² 5% í–¥ìƒ</span>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">ì™„ë£Œëœ ë¬¸ì œ</div>
                <div class="metric-value" id="completedProblems">0</div>
                <span class="metric-change positive">ì˜¤ëŠ˜ +45</span>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">í‰ê·  í•™ìŠµ ì‹œê°„</div>
                <div class="metric-value" id="avgStudyTime">0ë¶„</div>
                <span class="metric-change negative">â–¼ 3ë¶„ ê°ì†Œ</span>
            </div>
        </div>
        
        <!-- Charts Section -->
        <div class="charts-section">
            <!-- ê°œë…ë³„ ìˆ™ë‹¬ë„ ì°¨íŠ¸ -->
            <div class="chart-card">
                <h3 class="chart-title">ê°œë…ë³„ í‰ê·  ìˆ™ë‹¬ë„</h3>
                <canvas id="conceptMasteryChart"></canvas>
            </div>
            
            <!-- ì‹œê°„ëŒ€ë³„ í™œë™ ì°¨íŠ¸ -->
            <div class="chart-card">
                <h3 class="chart-title">ì‹œê°„ëŒ€ë³„ í•™ìŠµ í™œë™</h3>
                <canvas id="activityChart"></canvas>
            </div>
            
            <!-- ë¬¸ì œ ìœ í˜•ë³„ ì„±ê³¼ -->
            <div class="chart-card">
                <h3 class="chart-title">ë¬¸ì œ ìœ í˜•ë³„ ì •ë‹µë¥ </h3>
                <canvas id="problemTypeChart"></canvas>
            </div>
            
            <!-- Scaffolding íš¨ê³¼ì„± -->
            <div class="chart-card">
                <h3 class="chart-title">Scaffolding ì‚¬ìš© íŒ¨í„´</h3>
                <canvas id="scaffoldingChart"></canvas>
            </div>
        </div>
        
        <!-- Student Progress Table -->
        <div class="student-table">
            <div class="table-header">
                ê°œë³„ í•™ìƒ ì§„ë„ í˜„í™©
            </div>
            <table>
                <thead>
                    <tr>
                        <th>í•™ìƒ ì´ë¦„</th>
                        <th>ì§„ë„ìœ¨</th>
                        <th>ì •ë‹µë¥ </th>
                        <th>ì£¼ìš” ê°œë…</th>
                        <th>ì¶”ì²œ ì¡°ì¹˜</th>
                        <th>ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody id="studentTableBody">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </tbody>
            </table>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="exportReport()">
                ğŸ“Š ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°
            </button>
            <button class="btn btn-secondary" onclick="generateRecommendations()">
                ğŸ¯ ë§ì¶¤ ë¬¸ì œ ìƒì„±
            </button>
            <button class="btn btn-secondary" onclick="scheduleIntervention()">
                ğŸ‘¥ ê°œë³„ ì§€ë„ ì˜ˆì•½
            </button>
        </div>
        
        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loadingSpinner"></div>
        
        <!-- Realtime Status -->
        <div class="realtime-indicator">
            <div class="status-dot"></div>
            <span>ì‹¤ì‹œê°„ ì—°ê²°ë¨</span>
        </div>
    </div>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let socket = null;
        let dashboardData = {
            students: [],
            problems: [],
            sessions: [],
            analytics: {}
        };
        
        // ì´ˆê¸°í™”
        window.onload = function() {
            initializeDashboard();
            connectWebSocket();
            loadDashboardData();
            setupCharts();
        };
        
        function initializeDashboard() {
            // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('periodFilter').addEventListener('change', filterData);
            document.getElementById('classFilter').addEventListener('change', filterData);
            document.getElementById('typeFilter').addEventListener('change', filterData);
        }
        
        function connectWebSocket() {
            socket = io('http://localhost:8099');
            
            socket.on('connect', () => {
                console.log('Dashboard connected to server');
                updateConnectionStatus(true);
            });
            
            socket.on('disconnect', () => {
                updateConnectionStatus(false);
            });
            
            // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            socket.on('dashboard_update', (data) => {
                updateMetrics(data.metrics);
                updateCharts(data.charts);
            });
            
            socket.on('student_progress', (data) => {
                updateStudentRow(data);
            });
            
            socket.on('new_completion', (data) => {
                showCompletionNotification(data);
                incrementCompletedProblems();
            });
        }
        
        async function loadDashboardData() {
            showLoading(true);
            
            try {
                // APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const [students, analytics] = await Promise.all([
                    fetch('/api/ratio/students').then(r => r.json()),
                    fetch('/api/ratio/analytics').then(r => r.json())
                ]);
                
                dashboardData.students = students.data || [];
                dashboardData.analytics = analytics.data || {};
                
                // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
                updateMetrics({
                    activeStudents: dashboardData.students.filter(s => s.active).length,
                    avgAccuracy: calculateAverageAccuracy(),
                    completedProblems: countCompletedProblems(),
                    avgStudyTime: calculateAverageStudyTime()
                });
                
                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                populateStudentTable();
                
                // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                updateAllCharts();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            } finally {
                showLoading(false);
            }
        }
        
        function updateMetrics(metrics) {
            if (metrics.activeStudents !== undefined) {
                animateNumber('activeStudents', metrics.activeStudents);
            }
            if (metrics.avgAccuracy !== undefined) {
                animateNumber('avgAccuracy', Math.round(metrics.avgAccuracy * 100) + '%');
            }
            if (metrics.completedProblems !== undefined) {
                animateNumber('completedProblems', metrics.completedProblems);
            }
            if (metrics.avgStudyTime !== undefined) {
                animateNumber('avgStudyTime', Math.round(metrics.avgStudyTime) + 'ë¶„');
            }
        }
        
        function animateNumber(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            // ê°„ë‹¨í•œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            element.style.transform = 'scale(1.1)';
            element.textContent = newValue;
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 300);
        }
        
        function setupCharts() {
            // ê°œë…ë³„ ìˆ™ë‹¬ë„ ì°¨íŠ¸
            const conceptCtx = document.getElementById('conceptMasteryChart').getContext('2d');
            window.conceptChart = new Chart(conceptCtx, {
                type: 'radar',
                data: {
                    labels: ['ë¹„ì˜ í‘œí˜„', 'ë¹„ ê°„ë‹¨íˆ', 'ë¹„ë¡€ì‹', 'ë‹¨ìœ„ ë¹„ìœ¨', 'ì¶•ì²™', 'ì‹¤ìƒí™œ ì‘ìš©'],
                    datasets: [{
                        label: 'í‰ê·  ìˆ™ë‹¬ë„',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // ì‹œê°„ëŒ€ë³„ í™œë™ ì°¨íŠ¸
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            window.activityChart = new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00'],
                    datasets: [{
                        label: 'í™œì„± í•™ìƒ ìˆ˜',
                        data: [0, 0, 0, 0, 0, 0, 0, 0],
                        borderColor: 'rgba(102, 126, 234, 1)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // ë¬¸ì œ ìœ í˜•ë³„ ì„±ê³¼
            const typeCtx = document.getElementById('problemTypeChart').getContext('2d');
            window.typeChart = new Chart(typeCtx, {
                type: 'bar',
                data: {
                    labels: ['ì‹œê°ì  ë¹„', 'ìˆ˜ì¹˜ì  ë¹„', 'ì‹¤ìƒí™œ ì‘ìš©'],
                    datasets: [{
                        label: 'ì •ë‹µë¥ ',
                        data: [0, 0, 0],
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.8)',
                            'rgba(255, 152, 0, 0.8)',
                            'rgba(244, 67, 54, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Scaffolding ì°¨íŠ¸
            const scaffoldingCtx = document.getElementById('scaffoldingChart').getContext('2d');
            window.scaffoldingChart = new Chart(scaffoldingCtx, {
                type: 'doughnut',
                data: {
                    labels: ['íŒíŠ¸ë§Œ', 'ì‹œê°ì  ë„êµ¬', 'ì˜ˆì‹œ ë¬¸ì œ', 'ë‹¨ê³„ë³„ ê°€ì´ë“œ'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(255, 152, 0, 0.8)',
                            'rgba(76, 175, 80, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        function populateStudentTable() {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';
            
            // ìƒ˜í”Œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì˜´)
            const sampleStudents = [
                {
                    name: 'ê¹€ë¯¼ìˆ˜',
                    progress: 70,
                    accuracy: 85,
                    concepts: [
                        { name: 'ë¹„ì˜ í‘œí˜„', level: 'mastered' },
                        { name: 'ë¹„ë¡€ì‹', level: 'learning' },
                        { name: 'ì‹¤ìƒí™œ ì‘ìš©', level: 'struggling' }
                    ],
                    recommendation: 'ì‹¤ìƒí™œ ì‘ìš© ì¶”ê°€ ì—°ìŠµ í•„ìš”'
                },
                {
                    name: 'ì´ì„œì—°',
                    progress: 90,
                    accuracy: 92,
                    concepts: [
                        { name: 'ë¹„ì˜ í‘œí˜„', level: 'mastered' },
                        { name: 'ë¹„ë¡€ì‹', level: 'mastered' },
                        { name: 'ì¶•ì²™', level: 'learning' }
                    ],
                    recommendation: 'ì‹¬í™” ë¬¸ì œ ì œê³µ ê°€ëŠ¥'
                },
                {
                    name: 'ë°•ì¤€í˜¸',
                    progress: 40,
                    accuracy: 65,
                    concepts: [
                        { name: 'ë¹„ì˜ í‘œí˜„', level: 'learning' },
                        { name: 'ë¹„ ê°„ë‹¨íˆ', level: 'struggling' },
                        { name: 'ë¹„ë¡€ì‹', level: 'struggling' }
                    ],
                    recommendation: 'ê¸°ì´ˆ ê°œë… ë³µìŠµ í•„ìš”'
                }
            ];
            
            sampleStudents.forEach(student => {
                const row = createStudentRow(student);
                tbody.appendChild(row);
            });
        }
        
        function createStudentRow(student) {
            const tr = document.createElement('tr');
            
            tr.innerHTML = `
                <td><strong>${student.name}</strong></td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${student.progress}%"></div>
                    </div>
                    <small>${student.progress}%</small>
                </td>
                <td>${student.accuracy}%</td>
                <td>
                    ${student.concepts.map(c => 
                        `<span class="concept-badge ${c.level}">${c.name}</span>`
                    ).join('')}
                </td>
                <td>${student.recommendation}</td>
                <td>
                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9em;"
                            onclick="viewStudentDetail('${student.name}')">
                        ìƒì„¸ë³´ê¸°
                    </button>
                </td>
            `;
            
            return tr;
        }
        
        function updateAllCharts() {
            // ìƒ˜í”Œ ë°ì´í„°ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateConceptChart([75, 82, 68, 71, 65, 78]);
            updateActivityChart([5, 12, 18, 15, 8, 10, 14, 6]);
            updateTypeChart([78, 72, 65]);
            updateScaffoldingChart([35, 28, 22, 15]);
        }
        
        function updateConceptChart(data) {
            if (window.conceptChart) {
                window.conceptChart.data.datasets[0].data = data;
                window.conceptChart.update();
            }
        }
        
        function updateActivityChart(data) {
            if (window.activityChart) {
                window.activityChart.data.datasets[0].data = data;
                window.activityChart.update();
            }
        }
        
        function updateTypeChart(data) {
            if (window.typeChart) {
                window.typeChart.data.datasets[0].data = data;
                window.typeChart.update();
            }
        }
        
        function updateScaffoldingChart(data) {
            if (window.scaffoldingChart) {
                window.scaffoldingChart.data.datasets[0].data = data;
                window.scaffoldingChart.update();
            }
        }
        
        function filterData() {
            const period = document.getElementById('periodFilter').value;
            const classFilter = document.getElementById('classFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            
            // í•„í„°ë§ ë¡œì§ êµ¬í˜„
            console.log('Filtering:', { period, class: classFilter, type: typeFilter });
            
            // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            loadDashboardData();
        }
        
        function refreshDashboard() {
            loadDashboardData();
        }
        
        function exportReport() {
            // ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸° ë¡œì§
            alert('ë³´ê³ ì„œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...');
            
            // ì‹¤ì œë¡œëŠ” API í˜¸ì¶œí•˜ì—¬ PDF/Excel ìƒì„±
            fetch('/api/ratio/export-report', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    period: document.getElementById('periodFilter').value,
                    format: 'pdf'
                })
            }).then(response => response.blob())
              .then(blob => {
                  const url = window.URL.createObjectURL(blob);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = 'ratio-learning-report.pdf';
                  a.click();
              });
        }
        
        function generateRecommendations() {
            // ë§ì¶¤ ë¬¸ì œ ìƒì„±
            alert('ê°œì¸ë³„ ë§ì¶¤ ë¬¸ì œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...');
            
            // ì‹¤ì œë¡œëŠ” ê° í•™ìƒë³„ ë¶„ì„ í›„ ë¬¸ì œ ìƒì„±
            socket.emit('generate_adaptive_problems', {
                students: dashboardData.students.map(s => s.id)
            });
        }
        
        function scheduleIntervention() {
            // ê°œë³„ ì§€ë„ ì˜ˆì•½
            alert('ê°œë³„ ì§€ë„ê°€ í•„ìš”í•œ í•™ìƒ ëª©ë¡ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...');
        }
        
        function viewStudentDetail(studentName) {
            // í•™ìƒ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = `/student-detail.html?name=${encodeURIComponent(studentName)}`;
        }
        
        function updateConnectionStatus(connected) {
            const indicator = document.querySelector('.realtime-indicator');
            const dot = document.querySelector('.status-dot');
            const text = indicator.querySelector('span');
            
            if (connected) {
                dot.style.background = '#4caf50';
                text.textContent = 'ì‹¤ì‹œê°„ ì—°ê²°ë¨';
            } else {
                dot.style.background = '#f44336';
                text.textContent = 'ì—°ê²° ëŠê¹€';
            }
        }
        
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            spinner.style.display = show ? 'block' : 'none';
        }
        
        function showCompletionNotification(data) {
            // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
            console.log('Student completed:', data);
        }
        
        function incrementCompletedProblems() {
            const element = document.getElementById('completedProblems');
            const current = parseInt(element.textContent) || 0;
            animateNumber('completedProblems', current + 1);
        }
        
        function calculateAverageAccuracy() {
            if (!dashboardData.students.length) return 0;
            const total = dashboardData.students.reduce((sum, s) => sum + (s.accuracy || 0), 0);
            return total / dashboardData.students.length;
        }
        
        function countCompletedProblems() {
            return dashboardData.students.reduce((sum, s) => sum + (s.completedProblems || 0), 0);
        }
        
        function calculateAverageStudyTime() {
            if (!dashboardData.students.length) return 0;
            const total = dashboardData.students.reduce((sum, s) => sum + (s.studyTime || 0), 0);
            return Math.round(total / dashboardData.students.length);
        }
        
        function updateStudentRow(data) {
            // íŠ¹ì • í•™ìƒ í–‰ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            const rows = document.querySelectorAll('#studentTableBody tr');
            rows.forEach(row => {
                const nameCell = row.cells[0];
                if (nameCell.textContent === data.name) {
                    // ì§„ë„ìœ¨ ì—…ë°ì´íŠ¸
                    const progressBar = row.querySelector('.progress-fill');
                    if (progressBar) {
                        progressBar.style.width = `${data.progress}%`;
                    }
                    
                    // ì •ë‹µë¥  ì—…ë°ì´íŠ¸
                    row.cells[2].textContent = `${data.accuracy}%`;
                }
            });
        }
    </script>
</body>
</html>