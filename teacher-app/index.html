<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Platform - Teacher Review System</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        h1 {
            color: #5a67d8;
            font-size: 2em;
        }
        
        .budget-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .budget-card {
            background: #f7fafc;
            padding: 10px 20px;
            border-radius: 10px;
            border: 1px solid #cbd5e0;
        }
        
        .budget-label {
            font-size: 0.85em;
            color: #718096;
        }
        
        .budget-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #2d3748;
        }
        
        .budget-warning {
            color: #f56565;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #718096;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            color: #5a67d8;
            font-weight: 600;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #5a67d8;
        }
        
        .badge {
            display: inline-block;
            background: #f56565;
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.75em;
            margin-left: 5px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .review-queue {
            display: grid;
            gap: 20px;
        }
        
        .review-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .review-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .review-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .meta-tag {
            background: #edf2f7;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.9em;
        }
        
        .priority-high {
            background: #fed7d7;
            color: #c53030;
        }
        
        .problem-preview {
            background: white;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .problem-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .scaffolding-preview {
            background: #fff5f5;
            border-left: 4px solid #fc8181;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .btn-primary {
            background: #5a67d8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #4c51bf;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .btn-danger {
            background: #f56565;
            color: white;
        }
        
        .btn-danger:hover {
            background: #e53e3e;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #718096;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #4a5568;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 1em;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .scaffolding-editor {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .scaffolding-level {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }
        
        .level-header {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #5a67d8;
        }
        
        .stat-label {
            color: #718096;
            margin-top: 5px;
        }
        
        .generation-form {
            background: #f7fafc;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .cost-estimate {
            background: #fef5e7;
            border: 1px solid #f9c74f;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .cost-title {
            font-weight: 600;
            color: #f77f00;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            transition: width 0.3s;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-warning {
            background: #fef5e7;
            border: 1px solid #f9c74f;
            color: #f77f00;
        }
        
        .alert-success {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            color: #234e52;
        }
        
        .alert-error {
            background: #fed7d7;
            border: 1px solid #fc8181;
            color: #c53030;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>📚 Math Platform - Teacher Dashboard</h1>
            <div class="budget-info">
                <div class="budget-card">
                    <div class="budget-label">Daily Budget</div>
                    <div class="budget-value">$<span id="dailySpent">0.00</span> / $3.00</div>
                </div>
                <div class="budget-card">
                    <div class="budget-label">Monthly Budget</div>
                    <div class="budget-value">$<span id="monthlySpent">0.00</span> / $100</div>
                </div>
                <div class="budget-card">
                    <div class="budget-label">Students</div>
                    <div class="budget-value">10</div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('review')">
                Review Queue <span class="badge" id="reviewCount">3</span>
            </button>
            <button class="tab" onclick="switchTab('generate')">
                Generate Problems
            </button>
            <button class="tab" onclick="switchTab('approved')">
                Approved Problems
            </button>
            <button class="tab" onclick="switchTab('analytics')">
                Analytics
            </button>
        </div>

        <!-- Review Queue Section -->
        <div id="review" class="section active">
            <div class="alert alert-warning">
                ⏰ 3개의 문제 세트가 검토를 기다리고 있습니다. 24시간 내에 검토해주세요.
            </div>
            
            <div class="review-queue">
                <!-- Review Item 1 -->
                <div class="review-item">
                    <div class="review-header">
                        <div>
                            <h3>Algebra 1 - Unit 13: Quadratic Equations</h3>
                            <div class="review-meta">
                                <span class="meta-tag">Grade 8</span>
                                <span class="meta-tag">5 Problems</span>
                                <span class="meta-tag priority-high">High Priority</span>
                                <span class="meta-tag">Generated 2 hours ago</span>
                            </div>
                        </div>
                        <div>
                            <span class="budget-value">Cost: $0.0063</span>
                        </div>
                    </div>
                    
                    <div class="problem-preview">
                        <div class="problem-text">
                            <strong>Problem 1:</strong> $(x + 3)(x + 4) = ?$
                        </div>
                        <div class="scaffolding-preview">
                            <strong>Auto-generated Scaffolding (Level 3):</strong><br>
                            Step 1: FOIL 방법 적용<br>
                            Step 2: First: $x \cdot x = $ ___<br>
                            Step 3: Outer + Inner: ___ <br>
                            <em>→ 교사 검토 필요</em>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="openReviewModal('batch1')">
                            Review & Edit
                        </button>
                        <button class="btn btn-success" onclick="quickApprove('batch1')">
                            Quick Approve All
                        </button>
                        <button class="btn btn-danger" onclick="rejectBatch('batch1')">
                            Reject & Regenerate
                        </button>
                    </div>
                </div>

                <!-- Review Item 2 -->
                <div class="review-item">
                    <div class="review-header">
                        <div>
                            <h3>Geometry - Triangles</h3>
                            <div class="review-meta">
                                <span class="meta-tag">Grade 9</span>
                                <span class="meta-tag">3 Problems</span>
                                <span class="meta-tag">Generated 5 hours ago</span>
                            </div>
                        </div>
                        <div>
                            <span class="budget-value">Cost: $0.0038</span>
                        </div>
                    </div>
                    
                    <div class="problem-preview">
                        <div class="problem-text">
                            <strong>Problem 1:</strong> 직각삼각형에서 빗변의 길이가 13이고 한 변이 5일 때...
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="openReviewModal('batch2')">
                            Review & Edit
                        </button>
                        <button class="btn btn-success" onclick="quickApprove('batch2')">
                            Quick Approve All
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Generate Problems Section -->
        <div id="generate" class="section">
            <div class="generation-form">
                <h2>Generate New Problems</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Grade Level</label>
                        <select class="form-input" id="gradeSelect">
                            <option value="7">Grade 7</option>
                            <option value="8" selected>Grade 8</option>
                            <option value="9">Grade 9</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Unit</label>
                        <select class="form-input" id="unitSelect">
                            <option value="algebra1_unit13">Algebra 1 - Unit 13 (Quadratics)</option>
                            <option value="geometry_unit3">Geometry - Unit 3 (Triangles)</option>
                            <option value="algebra2_unit5">Algebra 2 - Unit 5 (Polynomials)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Topic</label>
                        <select class="form-input" id="topicSelect">
                            <option value="factoring">Factoring</option>
                            <option value="quadratic_formula">Quadratic Formula</option>
                            <option value="completing_square">Completing the Square</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Number of Problems</label>
                        <input type="number" class="form-input" id="countInput" value="5" min="1" max="20">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Special Requirements</label>
                    <textarea class="form-textarea" id="requirements" placeholder="예: SAT 스타일, 실생활 응용, 특정 난이도..."></textarea>
                </div>
                
                <div class="cost-estimate">
                    <div class="cost-title">예상 비용</div>
                    <div>문제 생성: $<span id="genCost">0.0063</span></div>
                    <div>일일 잔여 예산: $<span id="remainingBudget">2.94</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="budgetProgress" style="width: 2%"></div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="generateProblems()">
                        Generate Problems for Review
                    </button>
                    <button class="btn btn-secondary" onclick="useTemplates()">
                        Use Existing Templates (Free)
                    </button>
                </div>
            </div>
        </div>

        <!-- Approved Problems Section -->
        <div id="approved" class="section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">127</div>
                    <div class="stat-label">Total Approved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">89%</div>
                    <div class="stat-label">Approval Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">4.2</div>
                    <div class="stat-label">Avg Quality Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">12</div>
                    <div class="stat-label">Popular Templates</div>
                </div>
            </div>
            
            <h3>Recently Approved Problems</h3>
            <!-- Approved problems list would go here -->
        </div>

        <!-- Analytics Section -->
        <div id="analytics" class="section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">$42.50</div>
                    <div class="stat-label">Month to Date Spend</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">340</div>
                    <div class="stat-label">Problems Generated</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">2.3 hrs</div>
                    <div class="stat-label">Avg Review Time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">78%</div>
                    <div class="stat-label">Student Success Rate</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Review & Edit Problems</h2>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            
            <div id="modalContent">
                <!-- Dynamic content loaded here -->
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-success" onclick="approveWithEdits()">
                    Approve with Edits
                </button>
                <button class="btn btn-secondary" onclick="saveForLater()">
                    Save for Later
                </button>
                <button class="btn btn-danger" onclick="requestRegeneration()">
                    Request Regeneration
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize
        let currentBudget = {
            daily: 0.06,
            monthly: 42.50,
            remaining: 2.94
        };

        // Update budget display
        function updateBudgetDisplay() {
            document.getElementById('dailySpent').textContent = currentBudget.daily.toFixed(2);
            document.getElementById('monthlySpent').textContent = currentBudget.monthly.toFixed(2);
            document.getElementById('remainingBudget').textContent = currentBudget.remaining.toFixed(2);
            
            const progress = (currentBudget.daily / 3) * 100;
            document.getElementById('budgetProgress').style.width = progress + '%';
            
            if (currentBudget.daily > 2.4) {
                document.querySelector('.budget-value').classList.add('budget-warning');
            }
        }

        // Switch tabs
        function switchTab(tabName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(tabName).classList.add('active');
            
            // Activate selected tab
            event.target.classList.add('active');
        }

        // Generate problems
        async function generateProblems() {
            const grade = document.getElementById('gradeSelect').value;
            const unit = document.getElementById('unitSelect').value;
            const topic = document.getElementById('topicSelect').value;
            const count = document.getElementById('countInput').value;
            
            // Cost calculation
            const cost = count * 0.00125;
            
            if (currentBudget.remaining < cost) {
                alert('일일 예산을 초과합니다. 문제 수를 줄이거나 내일 다시 시도해주세요.');
                return;
            }
            
            // Show loading
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Generating...';
            
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        grade,
                        unit,
                        topic,
                        count: parseInt(count),
                        teacherId: 'teacher123',
                        preferences: {
                            language: 'ko',
                            scaffoldingLevel: 'semi-auto'
                        }
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`${count}개 문제가 생성되어 검토 큐에 추가되었습니다.`);
                    
                    // Update budget
                    currentBudget.daily += cost;
                    currentBudget.monthly += cost;
                    currentBudget.remaining -= cost;
                    updateBudgetDisplay();
                    
                    // Update review count
                    const reviewCount = parseInt(document.getElementById('reviewCount').textContent);
                    document.getElementById('reviewCount').textContent = reviewCount + 1;
                    
                    // Switch to review tab
                    switchTab('review');
                }
            } catch (error) {
                alert('문제 생성 중 오류가 발생했습니다.');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Generate Problems for Review';
            }
        }

        // Open review modal
        function openReviewModal(batchId) {
            const modal = document.getElementById('reviewModal');
            modal.classList.add('active');
            
            // Load batch content
            document.getElementById('modalContent').innerHTML = `
                <div class="form-group">
                    <label class="form-label">Problem 1</label>
                    <textarea class="form-textarea">$(x + 3)(x + 4) = ?$</textarea>
                </div>
                
                <div class="scaffolding-editor">
                    <h4>Scaffolding Levels (Semi-Automatic)</h4>
                    
                    <div class="scaffolding-level">
                        <div class="level-header">Level 1 (Minimal)</div>
                        <input type="text" class="form-input" value="빈칸 1개: 답만 채우기">
                    </div>
                    
                    <div class="scaffolding-level">
                        <div class="level-header">Level 2 (Guided)</div>
                        <textarea class="form-textarea">FOIL 방법 사용
F: x·x = ___
O+I: ___
L: ___</textarea>
                    </div>
                    
                    <div class="scaffolding-level">
                        <div class="level-header">Level 3 (Structured)</div>
                        <textarea class="form-textarea">Step 1: First terms 곱하기
Step 2: Outer + Inner terms
Step 3: Last terms 곱하기
Step 4: 모두 더하기</textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Quality Notes</label>
                    <textarea class="form-textarea" placeholder="수정사항이나 개선점을 입력하세요..."></textarea>
                </div>
            `;
        }

        // Close modal
        function closeModal() {
            document.getElementById('reviewModal').classList.remove('active');
        }

        // Quick approve
        function quickApprove(batchId) {
            if (confirm('5개 문제를 모두 승인하시겠습니까?')) {
                // Update UI
                const reviewCount = parseInt(document.getElementById('reviewCount').textContent);
                document.getElementById('reviewCount').textContent = Math.max(0, reviewCount - 1);
                
                // Remove item from queue
                event.target.closest('.review-item').style.display = 'none';
                
                // Show success message
                showAlert('문제가 승인되어 학생들에게 배포되었습니다.', 'success');
            }
        }

        // Show alert
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.querySelector('.section.active').insertBefore(alert, document.querySelector('.section.active').firstChild);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Update cost estimate
        document.getElementById('countInput').addEventListener('input', (e) => {
            const count = parseInt(e.target.value) || 0;
            const cost = count * 0.00125;
            document.getElementById('genCost').textContent = cost.toFixed(4);
        });

        // Initialize on load
        updateBudgetDisplay();
    </script>
</body>
</html>