<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìˆ˜í•™ ë¬¸ì œ ìƒì„± ì‹œìŠ¤í…œ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 30px;
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
      text-align: center;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      color: #555;
      font-weight: bold;
    }
    select, input {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #5a67d8;
    }
    #problems {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
    }
    .problem {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 5px;
      border-left: 4px solid #667eea;
    }
    .touch-canvas {
      border: 2px solid #ddd;
      border-radius: 10px;
      margin-top: 20px;
      touch-action: none;
      background: white;
    }
    .actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .status {
      padding: 10px;
      background: #e8f5e9;
      border-radius: 5px;
      margin-top: 20px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ ìˆ˜í•™ ë¬¸ì œ ìƒì„± ì‹œìŠ¤í…œ</h1>
    
    <div class="form-group">
      <label for="grade">í•™ë…„</label>
      <select id="grade">
        <option value="1">ì´ˆë“± 1í•™ë…„</option>
        <option value="2">ì´ˆë“± 2í•™ë…„</option>
        <option value="3">ì´ˆë“± 3í•™ë…„</option>
        <option value="4">ì´ˆë“± 4í•™ë…„</option>
        <option value="5">ì´ˆë“± 5í•™ë…„</option>
        <option value="6" selected>ì´ˆë“± 6í•™ë…„</option>
        <option value="7">ì¤‘ë“± 1í•™ë…„</option>
        <option value="8">ì¤‘ë“± 2í•™ë…„</option>
        <option value="9">ì¤‘ë“± 3í•™ë…„</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="topic">ì£¼ì œ</label>
      <select id="topic">
        <option value="arithmetic">ì‚¬ì¹™ì—°ì‚°</option>
        <option value="fractions" selected>ë¶„ìˆ˜</option>
        <option value="geometry">ë„í˜•</option>
        <option value="equations">ë°©ì •ì‹</option>
        <option value="ratio">ë¹„ì™€ ë¹„ìœ¨</option>
        <option value="statistics">í†µê³„</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="count">ë¬¸ì œ ê°œìˆ˜</label>
      <input type="number" id="count" value="5" min="1" max="20">
    </div>
    
    <div class="form-group">
      <label for="difficulty">ë‚œì´ë„</label>
      <select id="difficulty">
        <option value="easy">ì‰¬ì›€</option>
        <option value="medium" selected>ë³´í†µ</option>
        <option value="hard">ì–´ë ¤ì›€</option>
      </select>
    </div>
    
    <div class="actions">
      <button onclick="generateProblems()">ğŸŒ ë¬¸ì œ ìƒì„±</button>
      <button onclick="createPDF()" id="pdfBtn" style="display:none">ğŸ“„ PDF ìƒì„±</button>
    </div>
    
    <div class="status" id="status"></div>
    
    <div id="problems"></div>
    
    <!-- í„°ì¹˜ ìº”ë²„ìŠ¤ (Galaxy Book ìµœì í™”) -->
    <canvas class="touch-canvas" id="touchCanvas" width="800" height="400"></canvas>
  </div>

  <script>
    let currentProblems = [];
    let touchData = [];
    
    // í„°ì¹˜ ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
    const canvas = document.getElementById('touchCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    
    // í„°ì¹˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ (Galaxy Book 360 ìµœì í™”)
    canvas.addEventListener('pointerdown', startDrawing);
    canvas.addEventListener('pointermove', draw);
    canvas.addEventListener('pointerup', stopDrawing);
    
    function startDrawing(e) {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      ctx.beginPath();
      ctx.moveTo(x, y);
      
      // í„°ì¹˜ ë°ì´í„° ìˆ˜ì§‘
      touchData.push({
        type: 'start',
        x, y,
        pressure: e.pressure,
        timestamp: Date.now()
      });
    }
    
    function draw(e) {
      if (!isDrawing) return;
      
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      // ì••ë ¥ ê°ì§€ (S-Pen ì§€ì›)
      ctx.lineWidth = e.pressure ? e.pressure * 5 : 2;
      ctx.lineCap = 'round';
      ctx.strokeStyle = '#667eea';
      
      ctx.lineTo(x, y);
      ctx.stroke();
      
      // í„°ì¹˜ ë°ì´í„° ìˆ˜ì§‘
      touchData.push({
        type: 'move',
        x, y,
        pressure: e.pressure,
        timestamp: Date.now()
      });
    }
    
    function stopDrawing(e) {
      if (!isDrawing) return;
      isDrawing = false;
      
      // í„°ì¹˜ ë°ì´í„° ì„œë²„ë¡œ ì „ì†¡
      if (touchData.length > 0) {
        fetch('/touch-data', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            device: 'Galaxy Book 4 Pro 360',
            data: touchData,
            context: {
              grade: document.getElementById('grade').value,
              topic: document.getElementById('topic').value
            }
          })
        });
        touchData = [];
      }
    }
    
    async function generateProblems() {
      const grade = document.getElementById('grade').value;
      const topic = document.getElementById('topic').value;
      const count = document.getElementById('count').value;
      const difficulty = document.getElementById('difficulty').value;
      
      showStatus('ğŸ”„ ë¬¸ì œ ìƒì„± ì¤‘...');
      
      try {
        const response = await fetch('/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ grade, topic, count, difficulty })
        });
        
        const data = await response.json();
        
        if (data.status === 'draft') {
          currentProblems = data.problems;
          displayProblems(data.problems);
          showStatus('âœ… ë¬¸ì œ ìƒì„± ì™„ë£Œ! ê²€í†  í›„ PDFë¥¼ ìƒì„±í•˜ì„¸ìš”.');
          document.getElementById('pdfBtn').style.display = 'inline-block';
        }
      } catch (error) {
        showStatus('âŒ ì˜¤ë¥˜: ' + error.message, 'error');
      }
    }
    
    function displayProblems(problems) {
      const container = document.getElementById('problems');
      container.innerHTML = '<h2>ìƒì„±ëœ ë¬¸ì œ</h2>';
      
      problems.forEach((problem, index) => {
        const div = document.createElement('div');
        div.className = 'problem';
        div.innerHTML = `
          <strong>ë¬¸ì œ ${index + 1}:</strong> ${problem.question}<br>
          <small style="color: #666">ì •ë‹µ: ${problem.answer}</small>
        `;
        container.appendChild(div);
      });
    }
    
    async function createPDF() {
      if (!currentProblems.length) {
        showStatus('âš ï¸ ë¨¼ì € ë¬¸ì œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.', 'warning');
        return;
      }
      
      const studentName = prompt('í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
      
      showStatus('ğŸ“„ PDF ìƒì„± ì¤‘...');
      
      try {
        const response = await fetch('/create-pdf', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            problems: currentProblems,
            studentName,
            title: `${document.getElementById('grade').value}í•™ë…„ ${document.getElementById('topic').value} ë¬¸ì œ`
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          showStatus(`âœ… PDF ìƒì„± ì™„ë£Œ: ${data.filename}`);
          // PDF ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
          const link = document.createElement('a');
          link.href = data.path;
          link.download = data.filename;
          link.click();
        }
      } catch (error) {
        showStatus('âŒ PDF ìƒì„± ì‹¤íŒ¨: ' + error.message, 'error');
      }
    }
    
    function showStatus(message, type = 'success') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.style.display = 'block';
      status.style.background = 
        type === 'error' ? '#ffebee' :
        type === 'warning' ? '#fff3e0' :
        '#e8f5e9';
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
    window.addEventListener('resize', () => {
      const container = canvas.parentElement;
      canvas.width = container.clientWidth - 40;
    });
  </script>
</body>
</html>