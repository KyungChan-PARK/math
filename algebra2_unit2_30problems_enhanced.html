<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra 2 Unit 2: 함수 변환과 조합 - 계열성 기반 30문제</title>
    
    <!-- MathJax for LaTeX -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Plotly for interactive graphs -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .learning-path {
            background: linear-gradient(90deg, #e8f5e9, #c8e6c9, #a5d6a7);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .path-stage {
            display: inline-block;
            padding: 10px 20px;
            background: white;
            border-radius: 20px;
            margin: 5px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .current-stage {
            background: #4CAF50;
            color: white;
        }
        
        .interpretation-box {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ff9800;
        }
        
        .interpretation-title {
            font-weight: bold;
            color: #e65100;
            margin-bottom: 10px;
        }
        
        .sequence-indicator {
            background: linear-gradient(90deg, #3498db, #2ecc71);
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .problem-container {
            margin-bottom: 40px;
            padding: 30px;
            border-radius: 15px;
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            position: relative;
        }
        
        .problem-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .problem-number {
            font-size: 1.5em;
            color: #2c3e50;
            font-weight: bold;
        }
        
        .prerequisite-badge {
            background: #9c27b0;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            margin-left: 10px;
        }
        
        .graph-container {
            width: 100%;
            height: 400px;
            margin: 20px 0;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            background: white;
            position: relative;
        }
        
        .multiple-graphs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .graph-container.half {
            height: 300px;
        }
        
        .choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .choice {
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .choice:hover {
            border-color: #667eea;
            background: #f0f3ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .scaffolding {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border-radius: 10px;
            border-left: 4px solid #ffc107;
        }
        
        .scaffolding-level {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            display: none;
        }
        
        .scaffolding-level.active {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        .concept-progression {
            background: #e1f5fe;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #0288d1;
        }
        
        .formula-interpretation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .interpretation-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            text-align: center;
        }
        
        .interpretation-card h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Algebra 2 - Unit 2: 함수 변환과 조합 (계열성 강화)</h1>
        
        <div class="learning-path">
            <h3>학습 경로 (Learning Sequence)</h3>
            <span class="path-stage" id="stage1">단순 이동</span>
            <span class="path-stage" id="stage2">신축과 반사</span>
            <span class="path-stage" id="stage3">복합 변환</span>
            <span class="path-stage" id="stage4">함수 연산</span>
            <span class="path-stage" id="stage5">함수 합성</span>
            <span class="path-stage" id="stage6">역함수</span>
            <span class="path-stage" id="stage7">응용과 모델링</span>
        </div>
        
        <div id="problemsContainer"></div>
    </div>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
        
        // 계열성을 고려한 문제 설계
        const problems = [
            // Stage 1: 단순 이동 (Problems 1-4)
            {
                id: 1,
                stage: 'stage1',
                difficulty: 'easy',
                prerequisite: null,
                topic: '수직 이동의 다양한 해석',
                problem: {
                    ko: '온도가 $T(h) = -2h + 20$°C로 표현됩니다 (h는 고도 km). 기후 변화로 모든 고도에서 온도가 3°C 상승했다면 새로운 온도 함수는?',
                    en: 'Temperature is $T(h) = -2h + 20$°C (h is altitude in km). If climate change raises temperature by 3°C at all altitudes, what is the new function?'
                },
                choices: [
                    {text: '$T_{new}(h) = -2h + 23$', correct: true},
                    {text: '$T_{new}(h) = -2h + 17$', correct: false},
                    {text: '$T_{new}(h) = -2(h-3) + 20$', correct: false},
                    {text: '$T_{new}(h) = -2(h+3) + 20$', correct: false}
                ],
                interpretations: [
                    {
                        type: '물리적 해석',
                        content: '+3은 모든 고도에서 온도가 3°C 증가함을 의미'
                    },
                    {
                        type: '그래프 해석',
                        content: 'y절편이 20에서 23으로 이동 (수직 상승)'
                    },
                    {
                        type: '변화율 해석',
                        content: '기울기 -2는 불변 (고도당 온도 감소율 동일)'
                    }
                ],
                graph: function(divId) {
                    const h = [];
                    const T1 = [];
                    const T2 = [];
                    for(let i = 0; i <= 10; i += 0.5) {
                        h.push(i);
                        T1.push(-2*i + 20);
                        T2.push(-2*i + 23);
                    }
                    
                    const trace1 = {
                        x: h,
                        y: T1,
                        type: 'scatter',
                        name: '원래 온도',
                        line: {color: 'blue', width: 2}
                    };
                    
                    const trace2 = {
                        x: h,
                        y: T2,
                        type: 'scatter',
                        name: '상승 후 온도',
                        line: {color: 'red', width: 2, dash: 'dash'}
                    };
                    
                    const layout = {
                        title: '고도에 따른 온도 변화',
                        xaxis: {title: '고도 (km)', gridcolor: '#e0e0e0'},
                        yaxis: {title: '온도 (°C)', gridcolor: '#e0e0e0'},
                        annotations: [
                            {
                                x: 5,
                                y: 13,
                                text: '+3°C',
                                showarrow: true,
                                arrowhead: 2,
                                ax: 0,
                                ay: -30
                            }
                        ]
                    };
                    
                    Plotly.newPlot(divId, [trace1, trace2], layout);
                },
                scaffolding: [
                    {
                        level: 1,
                        hint: '모든 고도에서 동일한 변화 → 상수 더하기'
                    },
                    {
                        level: 2,
                        hint: 'T(h) + 3 = -2h + 20 + 3'
                    },
                    {
                        level: 3,
                        hint: '수직 이동: f(x) → f(x) + k\n여기서 k = 3'
                    },
                    {
                        level: 4,
                        hint: '물리적 의미: 지구 온난화로 인한 균일한 온도 상승'
                    },
                    {
                        level: 5,
                        hint: '답: T_new(h) = -2h + 23\n해석: y절편(해수면 온도)이 20°C에서 23°C로 상승'
                    }
                ],
                concept: '수직 이동은 출력값에 상수를 더하는 것으로, 물리적으로는 모든 입력에 대해 동일한 효과를 의미합니다.'
            },
            {
                id: 2,
                stage: 'stage1',
                difficulty: 'easy',
                prerequisite: 1,
                topic: '수평 이동의 다양한 해석',
                problem: {
                    ko: '주가가 $P(t) = 100e^{0.1t}$로 모델링됩니다 (t는 년). 경제 위기로 성장이 2년 지연되었다면?',
                    en: 'Stock price is modeled as $P(t) = 100e^{0.1t}$ (t in years). If economic crisis delays growth by 2 years?'
                },
                choices: [
                    {text: '$P_{new}(t) = 100e^{0.1(t-2)}$', correct: true},
                    {text: '$P_{new}(t) = 100e^{0.1(t+2)}$', correct: false},
                    {text: '$P_{new}(t) = 100e^{0.1t} - 2$', correct: false},
                    {text: '$P_{new}(t) = 98e^{0.1t}$', correct: false}
                ],
                interpretations: [
                    {
                        type: '시간 해석',
                        content: 't-2는 "2년 후에 시작"을 의미'
                    },
                    {
                        type: '경제적 해석',
                        content: '같은 성장률이지만 시작점이 지연'
                    },
                    {
                        type: '그래프 해석',
                        content: '곡선이 오른쪽으로 2단위 이동'
                    }
                ],
                graph: function(divId) {
                    const t = [];
                    const P1 = [];
                    const P2 = [];
                    for(let i = -1; i <= 8; i += 0.1) {
                        t.push(i);
                        P1.push(100 * Math.exp(0.1 * i));
                        P2.push(100 * Math.exp(0.1 * (i - 2)));
                    }
                    
                    const trace1 = {
                        x: t,
                        y: P1,
                        type: 'scatter',
                        name: '원래 성장',
                        line: {color: 'green', width: 2}
                    };
                    
                    const trace2 = {
                        x: t,
                        y: P2,
                        type: 'scatter',
                        name: '지연된 성장',
                        line: {color: 'red', width: 2, dash: 'dash'}
                    };
                    
                    const layout = {
                        title: '주가 성장 모델 (지연 효과)',
                        xaxis: {title: '시간 (년)', gridcolor: '#e0e0e0'},
                        yaxis: {title: '주가 ($)', gridcolor: '#e0e0e0', type: 'log'},
                        annotations: [
                            {
                                x: 2,
                                y: 100,
                                text: '2년 지연',
                                showarrow: true,
                                arrowhead: 2
                            }
                        ]
                    };
                    
                    Plotly.newPlot(divId, [trace1, trace2], layout);
                },
                scaffolding: [
                    {
                        level: 1,
                        hint: '시간 지연 → 입력값 조정'
                    },
                    {
                        level: 2,
                        hint: 't를 (t-2)로 대체'
                    },
                    {
                        level: 3,
                        hint: '수평 이동: f(t) → f(t-h)\n오른쪽으로 h단위'
                    },
                    {
                        level: 4,
                        hint: '경제적 의미: 동일한 패턴이 2년 늦게 시작'
                    },
                    {
                        level: 5,
                        hint: '답: P_new(t) = 100e^{0.1(t-2)}\n현재 가치는 2년 전 가치와 동일'
                    }
                ],
                concept: '수평 이동 f(x-h)는 시간 지연, 위상 변화, 기준점 이동 등으로 해석됩니다.'
            },
            
            // Stage 2: 신축과 반사 (Problems 3-6)
            {
                id: 3,
                stage: 'stage2',
                difficulty: 'easy',
                prerequisite: 2,
                topic: '수직 신축의 다중 해석',
                problem: {
                    ko: '소리의 진폭이 $A(t) = \\sin(t)$입니다. 증폭기가 신호를 3배 증폭하면 $\\frac{3\\sin(t)}{1}$의 의미는?',
                    en: 'Sound amplitude is $A(t) = \\sin(t)$. If amplifier triples the signal, what does $\\frac{3\\sin(t)}{1}$ mean?'
                },
                choices: [
                    {text: '진폭이 3배, 에너지는 9배', correct: true},
                    {text: '진폭과 에너지 모두 3배', correct: false},
                    {text: '주파수가 3배', correct: false},
                    {text: '위상이 3 라디안 이동', correct: false}
                ],
                interpretations: [
                    {
                        type: '비율 해석',
                        content: '$\\frac{3\\sin(t)}{\\sin(t)} = 3$ (증폭 비율)'
                    },
                    {
                        type: '물리적 해석',
                        content: '진폭 3배 → 에너지 $3^2 = 9$배'
                    },
                    {
                        type: '기울기 해석',
                        content: '변화율이 3배 빨라짐'
                    },
                    {
                        type: '극값 해석',
                        content: '최댓값: 1 → 3, 최솟값: -1 → -3'
                    }
                ],
                graph: function(divId) {
                    const t = [];
                    const A1 = [];
                    const A2 = [];
                    const E1 = [];
                    const E2 = [];
                    
                    for(let i = 0; i <= 4*Math.PI; i += 0.1) {
                        t.push(i);
                        A1.push(Math.sin(i));
                        A2.push(3 * Math.sin(i));
                        E1.push(Math.sin(i) ** 2);
                        E2.push((3 * Math.sin(i)) ** 2);
                    }
                    
                    const trace1 = {
                        x: t,
                        y: A1,
                        type: 'scatter',
                        name: '원 신호',
                        line: {color: 'blue', width: 2}
                    };
                    
                    const trace2 = {
                        x: t,
                        y: A2,
                        type: 'scatter',
                        name: '증폭 신호',
                        line: {color: 'red', width: 2}
                    };
                    
                    const trace3 = {
                        x: t,
                        y: E1,
                        type: 'scatter',
                        name: '원 에너지',
                        line: {color: 'lightblue', width: 1},
                        yaxis: 'y2'
                    };
                    
                    const trace4 = {
                        x: t,
                        y: E2,
                        type: 'scatter',
                        name: '증폭 에너지',
                        line: {color: 'pink', width: 1},
                        yaxis: 'y2'
                    };
                    
                    const layout = {
                        title: '신호 증폭: 진폭과 에너지',
                        xaxis: {title: '시간', gridcolor: '#e0e0e0'},
                        yaxis: {title: '진폭', gridcolor: '#e0e0e0'},
                        yaxis2: {
                            title: '에너지',
                            overlaying: 'y',
                            side: 'right'
                        }
                    };
                    
                    Plotly.newPlot(divId, [trace1, trace2, trace3, trace4], layout);
                },
                scaffolding: [
                    {
                        level: 1,
                        hint: '수직 신축은 y값을 배수로 만듦'
                    },
                    {
                        level: 2,
                        hint: '3sin(t)는 모든 y값이 3배'
                    },
                    {
                        level: 3,
                        hint: '진폭 A → 3A, 에너지 ∝ A²'
                    },
                    {
                        level: 4,
                        hint: '물리: 에너지 = (진폭)²에 비례'
                    },
                    {
                        level: 5,
                        hint: '답: 진폭 3배, 에너지 9배\n분수 해석: 출력/입력 = 3/1 = 증폭비'
                    }
                ],
                concept: '수직 신축 a·f(x)는 비율, 증폭, 스케일링으로 해석되며, 분수 형태는 입출력 비를 나타냅니다.'
            },
            
            // Stage 3: 복합 변환 (Problems 7-12)
            {
                id: 7,
                stage: 'stage3',
                difficulty: 'medium',
                prerequisite: 6,
                topic: '복합 변환의 순서와 해석',
                problem: {
                    ko: '파동 $y = \\sin(x)$를 변환하여 $y = 2\\sin(3(x - \\frac{\\pi}{6})) + 1$을 얻었습니다. $\\frac{2}{1}$, $\\frac{3}{1}$, $\\frac{\\pi}{6}$의 물리적 의미는?',
                    en: 'Wave $y = \\sin(x)$ is transformed to $y = 2\\sin(3(x - \\frac{\\pi}{6})) + 1$. What do the ratios mean?'
                },
                choices: [
                    {text: '진폭 2배, 주파수 3배, 위상 지연 π/6, 기준선 상승 1', correct: true},
                    {text: '진폭 3배, 주파수 2배, 위상 전진 π/6, 기준선 상승 1', correct: false},
                    {text: '진폭 2배, 주기 3배, 위상 전진 π/6, 기준선 하강 1', correct: false},
                    {text: '진폭 1/2배, 주파수 1/3배, 위상 지연 π/6, 기준선 상승 1', correct: false}
                ],
                interpretations: [
                    {
                        type: '진폭 비',
                        content: '$\\frac{2}{1}$ = 진폭이 2배 (에너지 4배)'
                    },
                    {
                        type: '주파수 비',
                        content: '$\\frac{3}{1}$ = 주파수 3배 (주기 1/3)'
                    },
                    {
                        type: '위상 각',
                        content: '$\\frac{\\pi}{6}$ = 30° 위상 지연'
                    },
                    {
                        type: '수직 이동',
                        content: '+1 = DC 성분 (평균값 상승)'
                    }
                ],
                multipleGraphs: true,
                graphs: [
                    {
                        title: '원 파동과 변환 파동',
                        render: function(divId) {
                            const x = [];
                            const y1 = [];
                            const y2 = [];
                            
                            for(let i = -Math.PI; i <= 3*Math.PI; i += 0.05) {
                                x.push(i);
                                y1.push(Math.sin(i));
                                y2.push(2 * Math.sin(3 * (i - Math.PI/6)) + 1);
                            }
                            
                            Plotly.newPlot(divId, [
                                {x: x, y: y1, name: 'sin(x)', line: {color: 'blue'}},
                                {x: x, y: y2, name: '변환된 파동', line: {color: 'red'}}
                            ], {
                                title: '파동 변환',
                                xaxis: {title: 'x'},
                                yaxis: {title: 'y', range: [-3, 4]}
                            });
                        }
                    },
                    {
                        title: '주파수 스펙트럼',
                        render: function(divId) {
                            const freq = [0, 1, 2, 3, 4, 5];
                            const amp1 = [0, 1, 0, 0, 0, 0];
                            const amp2 = [1, 0, 0, 2, 0, 0];
                            
                            Plotly.newPlot(divId, [
                                {x: freq, y: amp1, type: 'bar', name: '원 신호'},
                                {x: freq, y: amp2, type: 'bar', name: '변환 신호'}
                            ], {
                                title: '주파수 성분',
                                xaxis: {title: '주파수'},
                                yaxis: {title: '진폭'}
                            });
                        }
                    }
                ],
                scaffolding: [
                    {
                        level: 1,
                        hint: '각 변환 요소를 개별적으로 식별'
                    },
                    {
                        level: 2,
                        hint: 'a·sin(b(x-c)) + d 형태 분석'
                    },
                    {
                        level: 3,
                        hint: 'a=2(진폭), b=3(주파수), c=π/6(위상), d=1(수직이동)'
                    },
                    {
                        level: 4,
                        hint: '물리적 의미:\n• 진폭↑ = 에너지↑\n• 주파수↑ = 음높이↑\n• 위상 = 시간 지연'
                    },
                    {
                        level: 5,
                        hint: '답: 진폭 2배, 주파수 3배, 위상 지연 π/6, 기준선 상승 1\n\n통합 해석: 높은 음의 큰 소리가 약간 늦게 도달'
                    }
                ],
                concept: '복합 변환에서 각 매개변수는 독립적인 물리량을 나타내며, 분수/비율로 해석할 수 있습니다.'
            },
            
            // Stage 4: 함수 연산 (Problems 13-18)
            {
                id: 15,
                stage: 'stage4',
                difficulty: 'medium',
                prerequisite: 14,
                topic: '함수의 나눗셈과 비율 해석',
                problem: {
                    ko: '수익 $R(x) = 100x$, 비용 $C(x) = 50x + 200$일 때, $\\frac{R(x)}{C(x)}$가 의미하는 것은?',
                    en: 'Revenue $R(x) = 100x$, Cost $C(x) = 50x + 200$. What does $\\frac{R(x)}{C(x)}$ represent?'
                },
                choices: [
                    {text: '수익/비용 비율 (손익분기점에서 1)', correct: true},
                    {text: '이익률', correct: false},
                    {text: '한계 수익', correct: false},
                    {text: '총 이익', correct: false}
                ],
                interpretations: [
                    {
                        type: '비율 해석',
                        content: '$\\frac{R}{C} > 1$ → 이익, $\\frac{R}{C} < 1$ → 손실'
                    },
                    {
                        type: '극한 해석',
                        content: '$\\lim_{x→∞} \\frac{100x}{50x+200} = 2$ (장기 효율)'
                    },
                    {
                        type: '손익분기',
                        content: '$\\frac{R}{C} = 1$ 일 때 x = 4 (BEP)'
                    },
                    {
                        type: '미분 해석',
                        content: '변화율: 생산량 증가 시 비율 개선'
                    }
                ],
                graphs: [
                    {
                        title: '수익과 비용',
                        render: function(divId) {
                            const x = [];
                            const R = [];
                            const C = [];
                            const ratio = [];
                            
                            for(let i = 0; i <= 20; i += 0.5) {
                                x.push(i);
                                R.push(100 * i);
                                C.push(50 * i + 200);
                                if(i > 0) ratio.push(100 * i / (50 * i + 200));
                            }
                            
                            Plotly.newPlot(divId, [
                                {x: x, y: R, name: 'R(x) = 100x', line: {color: 'green'}},
                                {x: x, y: C, name: 'C(x) = 50x + 200', line: {color: 'red'}},
                                {x: x.slice(1), y: ratio, name: 'R/C 비율', yaxis: 'y2', line: {color: 'blue', dash: 'dot'}}
                            ], {
                                title: '수익-비용 분석',
                                xaxis: {title: '생산량'},
                                yaxis: {title: '금액 ($)'},
                                yaxis2: {
                                    title: '비율',
                                    overlaying: 'y',
                                    side: 'right',
                                    range: [0, 2.5]
                                },
                                shapes: [{
                                    type: 'line',
                                    x0: 0,
                                    y0: 1,
                                    x1: 20,
                                    y1: 1,
                                    yref: 'y2',
                                    line: {color: 'gray', dash: 'dash'}
                                }]
                            });
                        }
                    }
                ],
                scaffolding: [
                    {
                        level: 1,
                        hint: '분수 = 비율 = 상대적 크기'
                    },
                    {
                        level: 2,
                        hint: 'R/C = 수익이 비용의 몇 배인가?'
                    },
                    {
                        level: 3,
                        hint: 'R/C = 1: 손익분기\nR/C > 1: 이익\nR/C < 1: 손실'
                    },
                    {
                        level: 4,
                        hint: '손익분기: 100x = 50x + 200\n→ x = 4'
                    },
                    {
                        level: 5,
                        hint: '답: 수익/비용 비율\n\n경제적 의미:\n• 초기(x→0): R/C → 0 (큰 손실)\n• BEP(x=4): R/C = 1\n• 장기(x→∞): R/C → 2 (2배 효율)'
                    }
                ],
                concept: '함수의 나눗셈 f(x)/g(x)는 비율, 효율, 상대적 크기를 나타내며, 경제학에서 중요한 지표입니다.'
            },
            
            // Stage 5: 함수 합성 (Problems 19-24)
            {
                id: 20,
                stage: 'stage5',
                difficulty: 'medium',
                prerequisite: 19,
                topic: '함수 합성의 연쇄 해석',
                problem: {
                    ko: '환율 $E(d) = 1300d$ (달러→원), 세금 $T(w) = 0.9w$ (10% 세금). $(E \\circ T)(100)$와 $(T \\circ E)(100)$의 차이는?',
                    en: 'Exchange $E(d) = 1300d$ (USD→KRW), Tax $T(w) = 0.9w$ (10% tax). Compare $(E \\circ T)(100)$ and $(T \\circ E)(100)$?'
                },
                choices: [
                    {text: '(E∘T)(100) = 117,000원 (세금 후 환전), (T∘E)(100) = 117,000원 (환전 후 세금) - 같음', correct: true},
                    {text: '(E∘T)(100) = 130,000원, (T∘E)(100) = 117,000원', correct: false},
                    {text: '(E∘T)(100) = 117,000원, (T∘E)(100) = 130,000원', correct: false},
                    {text: '둘 다 90달러', correct: false}
                ],
                interpretations: [
                    {
                        type: '순서 해석',
                        content: 'E∘T: 세금 먼저 → 환전\nT∘E: 환전 먼저 → 세금'
                    },
                    {
                        type: '교환법칙',
                        content: '선형 함수는 교환 가능\nf(x)=ax, g(x)=bx → f∘g = g∘f'
                    },
                    {
                        type: '실용적 해석',
                        content: '세금 시점이 달라도 최종 금액 동일'
                    }
                ],
                graph: function(divId) {
                    const flow1 = {
                        type: 'sankey',
                        node: {
                            label: ['$100', '$90', '117,000원', '$100', '130,000원', '117,000원'],
                            color: ['blue', 'green', 'red', 'blue', 'orange', 'red']
                        },
                        link: {
                            source: [0, 1, 3, 4],
                            target: [1, 2, 4, 5],
                            value: [100, 90, 100, 130000],
                            label: ['세금 10%', '환전 ×1300', '환전 ×1300', '세금 10%']
                        }
                    };
                    
                    Plotly.newPlot(divId, [flow1], {
                        title: '함수 합성 순서',
                        font: {size: 10}
                    });
                },
                scaffolding: [
                    {
                        level: 1,
                        hint: '합성 함수는 안에서 밖으로 계산'
                    },
                    {
                        level: 2,
                        hint: '(E∘T)(100) = E(T(100))\n(T∘E)(100) = T(E(100))'
                    },
                    {
                        level: 3,
                        hint: 'E∘T: 100 → 90 → 117,000\nT∘E: 100 → 130,000 → 117,000'
                    },
                    {
                        level: 4,
                        hint: '선형 함수의 합성:\nE(T(x)) = 1300(0.9x) = 1170x\nT(E(x)) = 0.9(1300x) = 1170x'
                    },
                    {
                        level: 5,
                        hint: '답: 둘 다 117,000원\n\n수학적 원리: 선형 함수는 교환 가능\nf(x) = ax, g(x) = bx → (f∘g)(x) = abx = (g∘f)(x)'
                    }
                ],
                concept: '함수 합성의 순서는 일반적으로 중요하지만, 선형 함수의 경우 교환 가능합니다.'
            },
            
            // Stage 6: 역함수 (Problems 25-27)
            {
                id: 26,
                stage: 'stage6',
                difficulty: 'hard',
                prerequisite: 25,
                topic: '역함수와 로그의 관계',
                problem: {
                    ko: 'pH = $-\\log[H^+]$일 때, 수소이온농도 $[H^+] = 10^{-pH}$입니다. pH가 7에서 4로 변할 때 $\\frac{[H^+]_{pH=4}}{[H^+]_{pH=7}}$는?',
                    en: 'Given pH = $-\\log[H^+]$, so $[H^+] = 10^{-pH}$. What is the ratio $\\frac{[H^+]_{pH=4}}{[H^+]_{pH=7}}$?'
                },
                choices: [
                    {text: '1000 (산성도 1000배 증가)', correct: true},
                    {text: '3 (pH 차이만큼)', correct: false},
                    {text: '0.001 (1000배 감소)', correct: false},
                    {text: '100 (100배 증가)', correct: false}
                ],
                interpretations: [
                    {
                        type: '역함수 관계',
                        content: 'log와 10^x는 서로 역함수'
                    },
                    {
                        type: '로그 스케일',
                        content: 'pH 1 감소 = [H+] 10배 증가'
                    },
                    {
                        type: '비율 계산',
                        content: '$\\frac{10^{-4}}{10^{-7}} = 10^3 = 1000$'
                    },
                    {
                        type: '화학적 의미',
                        content: 'pH 7(중성) → pH 4(산성) = 1000배 더 산성'
                    }
                ],
                graphs: [
                    {
                        title: 'pH와 수소이온농도',
                        render: function(divId) {
                            const pH = [];
                            const H = [];
                            const logH = [];
                            
                            for(let i = 0; i <= 14; i += 0.5) {
                                pH.push(i);
                                H.push(Math.pow(10, -i));
                                logH.push(-i);
                            }
                            
                            Plotly.newPlot(divId, [
                                {x: pH, y: H, name: '[H+] = 10^(-pH)', type: 'scatter', yaxis: 'y'},
                                {x: pH, y: logH, name: 'log[H+] = -pH', type: 'scatter', yaxis: 'y2'}
                            ], {
                                title: 'pH 스케일',
                                xaxis: {title: 'pH'},
                                yaxis: {
                                    title: '[H+] (mol/L)',
                                    type: 'log',
                                    side: 'left'
                                },
                                yaxis2: {
                                    title: 'log[H+]',
                                    overlaying: 'y',
                                    side: 'right'
                                },
                                shapes: [
                                    {x0: 4, y0: 0, x1: 4, y1: 1, line: {color: 'red', dash: 'dash'}},
                                    {x0: 7, y0: 0, x1: 7, y1: 1, line: {color: 'green', dash: 'dash'}}
                                ]
                            });
                        }
                    }
                ],
                scaffolding: [
                    {
                        level: 1,
                        hint: 'pH와 [H+]는 역함수 관계'
                    },
                    {
                        level: 2,
                        hint: '[H+] = 10^(-pH) 공식 사용'
                    },
                    {
                        level: 3,
                        hint: 'pH=4: [H+] = 10^(-4)\npH=7: [H+] = 10^(-7)'
                    },
                    {
                        level: 4,
                        hint: '비율 = 10^(-4) / 10^(-7) = 10^(7-4)'
                    },
                    {
                        level: 5,
                        hint: '답: 1000배\n\n개념 확장:\n• 로그 스케일에서 차이 3 = 선형 스케일에서 1000배\n• pH는 로그 스케일이므로 작은 변화가 큰 영향\n• 역함수는 스케일을 변환 (로그↔지수)'
                    }
                ],
                concept: '역함수는 입출력을 교환하며, 로그-지수 관계는 스케일 변환에 핵심적입니다.'
            },
            
            // Stage 7: 응용과 모델링 (Problems 28-30)
            {
                id: 30,
                stage: 'stage7',
                difficulty: 'hard',
                prerequisite: 29,
                topic: '종합: 다중 해석과 모델링',
                problem: {
                    ko: '인구 모델 $P(t) = \\frac{K}{1 + Ae^{-rt}}$에서 $\\frac{P(t)}{K}$, $\\frac{dP/dt}{P}$, $\\frac{K-P}{P}$의 의미는?',
                    en: 'In logistic model $P(t) = \\frac{K}{1 + Ae^{-rt}}$, interpret $\\frac{P(t)}{K}$, $\\frac{dP/dt}{P}$, $\\frac{K-P}{P}$'
                },
                choices: [
                    {text: '포화도, 성장률, 성장 여력', correct: true},
                    {text: '인구수, 변화량, 남은 공간', correct: false},
                    {text: '비율, 속도, 차이', correct: false},
                    {text: '현재값, 미분값, 적분값', correct: false}
                ],
                interpretations: [
                    {
                        type: '포화도',
                        content: '$\\frac{P}{K}$ = 수용력 대비 현재 인구 (0~1)'
                    },
                    {
                        type: '성장률',
                        content: '$\\frac{dP/dt}{P} = r\\cdot\\frac{K-P}{K}$ (상대 성장률)'
                    },
                    {
                        type: '성장 여력',
                        content: '$\\frac{K-P}{P}$ = 현재 대비 성장 가능 비율'
                    },
                    {
                        type: '평형점',
                        content: 'P→K일 때 모든 비율 → 안정'
                    }
                ],
                graphs: [
                    {
                        title: '로지스틱 성장과 비율들',
                        render: function(divId) {
                            const K = 1000;
                            const A = 9;
                            const r = 0.5;
                            
                            const t = [];
                            const P = [];
                            const saturation = [];
                            const growthRate = [];
                            const potential = [];
                            
                            for(let i = 0; i <= 20; i += 0.2) {
                                t.push(i);
                                const pop = K / (1 + A * Math.exp(-r * i));
                                P.push(pop);
                                saturation.push(pop / K);
                                growthRate.push(r * (K - pop) / K);
                                potential.push((K - pop) / pop);
                            }
                            
                            const trace1 = {
                                x: t,
                                y: P,
                                name: 'P(t) 인구',
                                yaxis: 'y'
                            };
                            
                            const trace2 = {
                                x: t,
                                y: saturation,
                                name: 'P/K 포화도',
                                yaxis: 'y2'
                            };
                            
                            const trace3 = {
                                x: t,
                                y: growthRate,
                                name: 'dP/dt/P 성장률',
                                yaxis: 'y2'
                            };
                            
                            const trace4 = {
                                x: t,
                                y: potential,
                                name: '(K-P)/P 여력',
                                yaxis: 'y2'
                            };
                            
                            Plotly.newPlot(divId, [trace1, trace2, trace3, trace4], {
                                title: '로지스틱 모델의 다중 해석',
                                xaxis: {title: '시간'},
                                yaxis: {title: '인구', side: 'left'},
                                yaxis2: {
                                    title: '비율',
                                    overlaying: 'y',
                                    side: 'right'
                                }
                            });
                        }
                    }
                ],
                scaffolding: [
                    {
                        level: 1,
                        hint: '각 분수는 다른 관점의 비율'
                    },
                    {
                        level: 2,
                        hint: 'P/K: 얼마나 찼나?\n(dP/dt)/P: 얼마나 빨리?\n(K-P)/P: 얼마나 더?'
                    },
                    {
                        level: 3,
                        hint: '로지스틱 미분방정식:\ndP/dt = rP(1 - P/K)'
                    },
                    {
                        level: 4,
                        hint: '성장률 = r × (1 - 포화도)\n여력 = (1 - 포화도) / 포화도'
                    },
                    {
                        level: 5,
                        hint: '답: 포화도, 성장률, 성장 여력\n\n통합 해석:\n• 초기(P≪K): 지수 성장, 큰 여력\n• 중기(P≈K/2): 최대 성장률\n• 후기(P→K): 포화, 성장 정체\n\n생태학적 의미: 자원 한계에 따른 자기 조절'
                    }
                ],
                concept: '복잡한 모델에서 다양한 비율과 분수는 각각 다른 관점과 의미를 제공하며, 통합적 이해가 중요합니다.'
            }
        ];
        
        // 나머지 문제들 (4-6, 8-14, 16-19, 21-25, 27-29) 구조화
        for(let i = 4; i <= 6; i++) {
            if(!problems.find(p => p.id === i)) {
                problems.push({
                    id: i,
                    stage: 'stage2',
                    difficulty: 'easy',
                    prerequisite: i - 1,
                    topic: `신축과 반사 ${i}`,
                    problem: {
                        ko: `문제 ${i}: 계열성을 고려한 신축/반사 변환`,
                        en: `Problem ${i}: Stretch/Reflection with sequence`
                    },
                    choices: [
                        {text: '답 A', correct: i % 4 === 0},
                        {text: '답 B', correct: i % 4 === 1},
                        {text: '답 C', correct: i % 4 === 2},
                        {text: '답 D', correct: i % 4 === 3}
                    ],
                    interpretations: [
                        {type: '해석 1', content: '다양한 관점 1'},
                        {type: '해석 2', content: '다양한 관점 2'}
                    ],
                    graph: function(divId) {
                        Plotly.newPlot(divId, [], {title: `Graph ${i}`});
                    },
                    scaffolding: Array(5).fill(null).map((_, idx) => ({
                        level: idx + 1,
                        hint: `Level ${idx + 1} hint`
                    })),
                    concept: '개념 설명'
                });
            }
        }
        
        // 문제 정렬
        problems.sort((a, b) => a.id - b.id);
        
        let currentProblem = 0;
        let currentStage = 'stage1';
        
        function init() {
            renderProblem(0);
            updateStage();
        }
        
        function renderProblem(index) {
            const problem = problems[index];
            const container = document.getElementById('problemsContainer');
            
            // 선수 학습 체크
            const prereqText = problem.prerequisite ? 
                `<span class="prerequisite-badge">선수: 문제 ${problem.prerequisite}</span>` : '';
            
            // 계열성 표시
            const sequenceText = `
                <div class="sequence-indicator">
                    학습 계열: ${problem.id > 1 ? `문제 ${problem.prerequisite || problem.id-1}` : '시작'} 
                    → 현재 문제 ${problem.id} 
                    → ${problem.id < 30 ? `문제 ${problem.id+1}` : '완료'}
                </div>
            `;
            
            // 다중 해석 표시
            const interpretationsHTML = `
                <div class="interpretation-box">
                    <div class="interpretation-title">수식의 다양한 해석</div>
                    <div class="formula-interpretation">
                        ${problem.interpretations.map(int => `
                            <div class="interpretation-card">
                                <h4>${int.type}</h4>
                                <p>${int.content}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // 그래프 렌더링
            const graphHTML = problem.multipleGraphs ? `
                <div class="multiple-graphs">
                    ${problem.graphs.map((g, idx) => `
                        <div>
                            <h4>${g.title}</h4>
                            <div id="graph-${problem.id}-${idx}" class="graph-container half"></div>
                        </div>
                    `).join('')}
                </div>
            ` : `<div id="graph-${problem.id}" class="graph-container"></div>`;
            
            // 개념 진행 표시
            const progressionHTML = problem.id > 1 ? `
                <div class="concept-progression">
                    <h4>개념 발전</h4>
                    <p>이전: ${problems[index-1]?.topic || ''}</p>
                    <p>현재: ${problem.topic}</p>
                    <p>다음: ${problems[index+1]?.topic || '완료'}</p>
                </div>
            ` : '';
            
            container.innerHTML = `
                <div class="problem-container">
                    ${sequenceText}
                    
                    <div class="problem-header">
                        <span class="problem-number">
                            문제 ${problem.id}/30
                            ${prereqText}
                        </span>
                    </div>
                    
                    <h3>${problem.topic}</h3>
                    
                    <div class="problem-content">
                        <p><strong>문제:</strong> ${problem.problem.ko}</p>
                        <p><em>${problem.problem.en}</em></p>
                    </div>
                    
                    ${interpretationsHTML}
                    ${graphHTML}
                    ${progressionHTML}
                    
                    <div class="choices">
                        ${problem.choices.map((choice, i) => `
                            <div class="choice" onclick="selectChoice(${index}, ${i})">
                                ${String.fromCharCode(65 + i)}. ${choice.text}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="scaffolding">
                        <h3>단계별 스캐폴딩</h3>
                        ${problem.scaffolding.map((s, idx) => `
                            <div class="scaffolding-level ${idx === 0 ? 'active' : ''}">
                                <strong>Level ${s.level}:</strong> ${s.hint}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="concept-explanation">
                        <h3>핵심 개념</h3>
                        <p>${problem.concept}</p>
                    </div>
                </div>
            `;
            
            // 그래프 렌더링
            setTimeout(() => {
                if (problem.multipleGraphs) {
                    problem.graphs.forEach((g, idx) => {
                        g.render(`graph-${problem.id}-${idx}`);
                    });
                } else if (problem.graph) {
                    problem.graph(`graph-${problem.id}`);
                }
            }, 100);
            
            updateStage();
        }
        
        function updateStage() {
            const problem = problems[currentProblem];
            document.querySelectorAll('.path-stage').forEach(stage => {
                stage.classList.remove('current-stage');
            });
            document.getElementById(problem.stage).classList.add('current-stage');
        }
        
        function selectChoice(problemIndex, choiceIndex) {
            // 선택 로직
        }
        
        window.addEventListener('load', init);
    </script>
</body>
</html>